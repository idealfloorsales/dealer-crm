<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CRM Дилеры</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="style.css?v={{VER}}"> 
    <link rel="icon" href="favicon.gif" type="image/gif">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#b9040a">

    <style>
        body { padding-bottom: 80px; }
        /* Скрываем на десктопе, показываем на мобилке */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); border-top: 1px solid #eee; z-index: 1050; padding-bottom: env(safe-area-inset-bottom); box-shadow: 0 -5px 20px rgba(0,0,0,0.05); }
        .bottom-nav-item { text-align: center; color: #adb5bd; padding: 10px 0; text-decoration: none; flex: 1; transition: color 0.2s; }
        .bottom-nav-item.active { color: #B9040A; }
        .bottom-nav-item i { font-size: 1.4rem; display: block; margin-bottom: 2px; }
        .bottom-nav-item span { font-size: 0.65rem; font-weight: 600; }
        .desktop-nav { display: flex; }
        @media (max-width: 991px) { .desktop-nav { display: none !important; } }
        
        /* Кнопка настроек дашборда */
        .btn-dash-settings { background: none; border: none; color: #cbd5e1; transition: 0.2s; }
        .btn-dash-settings:hover { color: #64748b; }
    </style>
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top desktop-nav">
        <div class="container-fluid">
            <a class="navbar-brand" href="/"><img src="logo.png" alt="Logo" height="30"></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link active" href="/">Дилеры</a></li>
                    <li class="nav-item"><a class="nav-link" href="/map.html">Карта</a></li>
                    <li class="nav-item"><a class="nav-link" href="/products.html">Матрица</a></li>
                    <li class="nav-item"><a class="nav-link" href="/report.html">Выставленность</a></li>
                    <li class="nav-item"><a class="nav-link" href="/sales.html">Продажи</a></li>
                    <li class="nav-item"><a class="nav-link" href="/competitors.html">Конкуренты</a></li>
                    <li class="nav-item"><a class="nav-link" href="/knowledge.html">Статьи</a></li>
                    <li class="nav-item admin-only"><a class="nav-link" href="/users.html">Сотрудники</a></li>
                </ul>
                <div class="ms-auto d-flex align-items-center gap-3">
                    <span class="badge bg-light text-dark border" id="user-role-badge">Гость</span>
                    <button id="logout-btn" class="btn btn-sm btn-outline-danger">Выход</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container py-4" style="max-width: 800px;">
        
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="mb-0">Дилеры</h1>
                <p class="text-muted small mb-0">База клиентов и статистика</p>
            </div>
            <div class="d-flex gap-2">
                <button class="btn btn-primary shadow-sm d-none d-md-block" id="open-add-modal-btn"><i class="bi bi-plus-lg me-2"></i>Добавить</button>
                <button class="btn btn-light border shadow-sm d-none d-md-block" id="btn-manage-statuses"><i class="bi bi-tags-fill text-muted"></i></button>
                <button class="btn-dash-settings" id="btn-dash-settings"><i class="bi bi-gear-fill fs-5"></i></button>
            </div>
        </div>

        <div id="dashboard-stats" class="row g-2 mb-4">
            </div>

        <div class="sticky-filters mb-3">
            <div class="bg-white p-2 rounded-3 shadow-sm border d-flex gap-2">
                <div class="flex-grow-1 position-relative">
                    <i class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"></i>
                    <input type="text" id="search-bar" class="form-control border-0 ps-5" placeholder="Поиск...">
                </div>
                <select class="form-select border-0 bg-light" style="width: auto; max-width: 140px;" id="filter-city"></select>
                <select class="form-select border-0 bg-light" style="width: auto; max-width: 140px;" id="filter-status"></select>
                <select id="filter-price-type" style="display:none"></select>
                <select id="filter-responsible" style="display:none"></select>
            </div>
        </div>
        
        <div id="dealer-grid" class="d-flex flex-column gap-2"></div>

        <div class="d-flex justify-content-center gap-2 mt-4 mb-5">
            <button class="btn btn-sm btn-light border text-success" id="export-dealers-btn"><i class="bi bi-file-earmark-excel me-2"></i>Скачать Базу</button>
            <button class="btn btn-sm btn-light border text-primary" id="export-competitors-prices-btn"><i class="bi bi-tag me-2"></i>Скачать Цены</button>
        </div>

        <h5 class="fw-bold text-dark mb-3 mt-5"><i class="bi bi-exclamation-circle text-danger me-2"></i>Проблемы и Просрочки</h5>
        <div id="tasks-list-problem" class="task-list-modern mb-4"></div>

        <h5 class="fw-bold text-dark mb-3"><i class="bi bi-calendar-check text-primary me-2"></i>План посещений</h5>
        <div id="tasks-list-upcoming" class="task-list-modern mb-4"></div>

        <h5 class="fw-bold text-dark mb-3"><i class="bi bi-hourglass-split text-warning me-2"></i>Давно не были (>15 дней)</h5>
        <div id="tasks-list-cooling" class="task-list-modern mb-5"></div>
    </div>

    <div class="bottom-nav d-flex justify-content-around d-lg-none">
        <a href="/" class="bottom-nav-item active"><i class="bi bi-shop"></i><span>Дилеры</span></a>
        <a href="/map.html" class="bottom-nav-item"><i class="bi bi-geo-alt"></i><span>Карта</span></a>
        <a href="/sales.html" class="bottom-nav-item"><i class="bi bi-graph-up-arrow"></i><span>Продажи</span></a>
        <a href="/competitors.html" class="bottom-nav-item"><i class="bi bi-globe"></i><span>Бренды</span></a>
        <a href="/report.html" class="bottom-nav-item"><i class="bi bi-pie-chart"></i><span>Отчет</span></a>
    </div>

    <button id="mobile-fab-add" class="btn btn-primary rounded-circle shadow-lg d-md-none" 
        style="position: fixed; bottom: 80px; right: 20px; width: 56px; height: 56px; z-index: 1060; font-size: 24px;"
        onclick="document.getElementById('open-add-modal-btn').click()">
        <i class="bi bi-plus-lg"></i>
    </button>

    <div class="modal fade" id="add-modal" tabindex="-1">
         <div class="modal-dialog modal-fullscreen-sm-down modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Новый дилер</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="wizard-progress-container mb-4">
                        <div class="wizard-progress-bar"></div>
                        <div class="wizard-steps-wrapper">
                            <div class="step-circle active" id="step-ind-1">1</div>
                            <div class="step-circle" id="step-ind-2">2</div>
                            <div class="step-circle" id="step-ind-3">3</div>
                            <div class="step-circle" id="step-ind-4">4</div>
                        </div>
                    </div>

                    <form id="add-dealer-form">
                        <div class="wizard-step active" id="step-1">
                            <h6 class="mb-3">Основное</h6>
                            <div class="row g-2">
                                <div class="col-4"><input type="text" id="dealer_id" class="form-control" placeholder="ID (101)" required></div>
                                <div class="col-8"><input type="text" id="name" class="form-control" placeholder="Название (ИП ...)" required></div>
                                <div class="col-12" id="add-org-list"><button type="button" id="btn-add-org-add" class="btn btn-sm btn-outline-secondary w-100">+ Юр.лицо</button></div>
                                <div class="col-6"><input type="text" id="city" class="form-control" placeholder="Город"></div>
                                <div class="col-6"><select id="status" class="form-select"></select></div>
                                <div class="col-12"><input type="text" id="address" class="form-control" placeholder="Адрес (Улица, дом)"></div>
                                <div class="col-12">
                                    <div class="input-group">
                                        <input type="text" id="add-smart-search" class="form-control" placeholder="Поиск по карте...">
                                        <button class="btn btn-outline-secondary" type="button" id="btn-search-add"><i class="bi bi-search"></i></button>
                                        <button class="btn btn-outline-secondary" type="button" id="btn-loc-add"><i class="bi bi-geo-alt"></i></button>
                                    </div>
                                    <div id="add-map" style="height: 200px; border-radius: 8px; margin-top: 5px;" class="border"></div>
                                    <input type="hidden" id="add_latitude"><input type="hidden" id="add_longitude">
                                </div>
                            </div>
                        </div>
                        
                        <div class="wizard-step" id="step-2">
                             <h6 class="mb-3">Детали</h6>
                             <div class="row g-2">
                                 <div class="col-6"><input type="text" id="price_type" class="form-control" placeholder="Тип цен"></div>
                                 <div class="col-6"><input type="text" id="delivery" class="form-control" placeholder="Доставка"></div>
                                 <div class="col-6"><input type="text" id="website" class="form-control" placeholder="Сайт"></div>
                                 <div class="col-6"><input type="text" id="instagram" class="form-control" placeholder="Instagram"></div>
                                 <div class="col-12"><textarea id="bonuses" class="form-control" placeholder="Бонусы / Заметки"></textarea></div>
                                 
                                 <div class="col-12 mt-3 p-3 bg-light rounded border">
                                    <label class="form-label small fw-bold">Договор</label>
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="add_contract_signed">
                                            <label class="form-check-label" for="add_contract_signed">Подписан</label>
                                        </div>
                                        <input type="date" id="add_contract_date" class="form-control form-control-sm" style="width: 140px;">
                                    </div>
                                </div>

                                 <div class="col-12 mt-3">
                                     <label class="form-label small">Ответственный</label>
                                     <select class="form-select" id="responsible" onchange="toggleSectorSelect('add', this.value)">
                                         <option value="regional_astana">Региональный Астана</option>
                                         <option value="regional_regions">Региональный Регионы</option>
                                         <option value="office">Офис / Прочее</option>
                                     </select>
                                     <select class="form-select mt-2" id="add_region_sector" style="display:none;">
                                         <option value="">-- Выберите сектор --</option>
                                         <option value="Север">Север</option><option value="Юг">Юг</option><option value="Запад">Запад</option><option value="Восток">Восток</option><option value="Центр">Центр</option>
                                     </select>
                                 </div>
                             </div>
                        </div>

                        <div class="wizard-step" id="step-3">
                             <div class="mb-3"><div class="d-flex justify-content-between"><h6 class="mb-1">Контакты</h6><button type="button" class="btn btn-sm btn-link p-0" id="add-contact-btn-add-modal">+ Добавить</button></div><div id="add-contact-list"></div></div>
                             <div class="mb-3"><div class="d-flex justify-content-between"><h6 class="mb-1">Доп. адреса</h6><button type="button" class="btn btn-sm btn-link p-0" id="add-address-btn-add-modal">+ Добавить</button></div><div id="add-address-list"></div></div>
                             <div class="mb-3"><div class="d-flex justify-content-between"><h6 class="mb-1">POS Материалы</h6><button type="button" class="btn btn-sm btn-link p-0" id="add-pos-btn-add-modal">+ Добавить</button></div><div id="add-pos-list"></div></div>
                             <div class="mb-3"><div class="d-flex justify-content-between"><h6 class="mb-1">Визиты (История)</h6><button type="button" class="btn btn-sm btn-link p-0" id="add-visits-btn-add-modal">+ Добавить</button></div><div id="add-visits-list"></div></div>
                             <div class="mb-3"><div class="d-flex justify-content-between"><h6 class="mb-1">Конкуренты</h6><button type="button" class="btn btn-sm btn-link p-0" id="add-competitor-btn-add-modal">+ Добавить</button></div><div id="add-competitor-list"></div></div>
                        </div>

                        <div class="wizard-step" id="step-4">
                             <div class="mb-3">
                                 <h6>Аватарка</h6>
                                 <input type="file" id="add-avatar-input" class="form-control mb-2" accept="image/*">
                                 <img id="add-avatar-preview" class="avatar-preview" src="">
                             </div>
                             <div class="mb-3">
                                 <h6>Фото магазина</h6>
                                 <input type="file" id="add-photo-input" class="form-control" multiple accept="image/*">
                                 <div id="add-photo-preview-container" class="photo-preview-grid"></div>
                             </div>
                             <div class="mb-3">
                                 <h6>Матрица товаров</h6>
                                 <div id="add-product-checklist" class="product-checklist"></div>
                             </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-light" id="btn-prev-step" style="display:none;">Назад</button>
                    <button type="button" class="btn btn-primary" id="btn-next-step">Далее</button>
                    <button type="submit" form="add-dealer-form" class="btn btn-success" id="btn-finish-step" style="display:none;">Готово</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="edit-modal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen-sm-down modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Редактирование</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <form id="edit-dealer-form">
                        <input type="hidden" id="edit_db_id">
                        
                        <ul class="nav nav-tabs modal-tabs nav-fill pt-2 px-2" id="editTabs" role="tablist">
                            <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-main" type="button">Главное</button></li>
                            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-details" type="button">Детали</button></li>
                            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-map" type="button">Карта</button></li>
                            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-products" type="button">Матрица</button></li>
                        </ul>

                        <div class="tab-content p-3">
                            <div class="tab-pane fade show active" id="tab-main">
                                <div class="row g-2">
                                    <div class="col-4"><label class="small text-muted">ID</label><input type="text" id="edit_dealer_id" class="form-control" required></div>
                                    <div class="col-8"><label class="small text-muted">Название</label><input type="text" id="edit_name" class="form-control" required></div>
                                    <div class="col-12"><label class="small text-muted">Юр. лица</label><div id="edit-org-list"></div><button type="button" id="btn-edit-org-add" class="btn btn-sm btn-link px-0">+ Добавить ЮЛ</button></div>
                                    <div class="col-6"><label class="small text-muted">Город</label><input type="text" id="edit_city" class="form-control"></div>
                                    <div class="col-6"><label class="small text-muted">Статус</label><select id="edit_status" class="form-select"></select></div>
                                    <div class="col-12"><label class="small text-muted">Адрес</label><input type="text" id="edit_address" class="form-control"></div>
                                    
                                    <div class="col-12 mt-2">
                                        <div class="form-check form-switch p-2 bg-warning-subtle rounded border border-warning">
                                            <input class="form-check-input" type="checkbox" id="edit_has_personal_plan">
                                            <label class="form-check-label fw-bold text-dark" for="edit_has_personal_plan">⭐ VIP клиент (Влияет на план)</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="tab-details">
                                <div class="row g-2">
                                    <div class="col-6"><input type="text" id="edit_price_type" class="form-control" placeholder="Тип цен"></div>
                                    <div class="col-6"><input type="text" id="edit_delivery" class="form-control" placeholder="Доставка"></div>
                                    <div class="col-6"><input type="text" id="edit_website" class="form-control" placeholder="Сайт"></div>
                                    <div class="col-6"><input type="text" id="edit_instagram" class="form-control" placeholder="Instagram"></div>
                                    <div class="col-12"><textarea id="edit_bonuses" class="form-control" placeholder="Заметки"></textarea></div>

                                    <div class="col-12 mt-3 p-3 bg-light rounded border">
                                        <label class="form-label small fw-bold">Договор</label>
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="edit_contract_signed">
                                                <label class="form-check-label" for="edit_contract_signed">Подписан</label>
                                            </div>
                                            <input type="date" id="edit_contract_date" class="form-control form-control-sm" style="width: 140px;">
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                         <label class="form-label small">Ответственный</label>
                                         <select class="form-select" id="edit_responsible" onchange="toggleSectorSelect('edit', this.value)">
                                             <option value="regional_astana">Региональный Астана</option>
                                             <option value="regional_regions">Региональный Регионы</option>
                                             <option value="office">Офис / Прочее</option>
                                         </select>
                                         <select class="form-select mt-2" id="edit_region_sector" style="display:none;">
                                             <option value="">-- Выберите сектор --</option>
                                             <option value="Север">Север</option><option value="Юг">Юг</option><option value="Запад">Запад</option><option value="Восток">Восток</option><option value="Центр">Центр</option>
                                         </select>
                                     </div>

                                    <div class="col-12 mt-3"><div class="d-flex justify-content-between"><h6 class="small fw-bold">Контакты</h6><button type="button" class="btn btn-sm btn-link p-0" id="add-contact-btn-edit-modal">+ Add</button></div><div id="edit-contact-list"></div></div>
                                    <div class="col-12"><div class="d-flex justify-content-between"><h6 class="small fw-bold">Доп. адреса</h6><button type="button" class="btn btn-sm btn-link p-0" id="add-address-btn-edit-modal">+ Add</button></div><div id="edit-address-list"></div></div>
                                    <div class="col-12"><div class="d-flex justify-content-between"><h6 class="small fw-bold">Визиты</h6><button type="button" class="btn btn-sm btn-link p-0" id="add-visits-btn-edit-modal">+ Add</button></div><div id="edit-visits-list"></div></div>
                                    <div class="col-12"><div class="d-flex justify-content-between"><h6 class="small fw-bold">Конкуренты</h6><button type="button" class="btn btn-sm btn-link p-0" id="add-competitor-btn-edit-modal">+ Add</button></div><div id="edit-competitor-list"></div></div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="tab-map">
                                <div class="input-group mb-2">
                                    <input type="text" id="edit-smart-search" class="form-control" placeholder="Поиск...">
                                    <button class="btn btn-outline-secondary" type="button" id="btn-search-edit"><i class="bi bi-search"></i></button>
                                    <button class="btn btn-outline-secondary" type="button" id="btn-loc-edit"><i class="bi bi-geo-alt"></i></button>
                                </div>
                                <div id="edit-map" style="height: 300px; border-radius: 8px;" class="border"></div>
                                <div class="row g-1 mt-2">
                                    <div class="col-6"><input type="text" id="edit_latitude" class="form-control form-control-sm" readonly></div>
                                    <div class="col-6"><input type="text" id="edit_longitude" class="form-control form-control-sm" readonly></div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="tab-products">
                                <div class="mb-3">
                                     <div class="d-flex justify-content-between"><h6 class="small fw-bold">POS Оборудование</h6><button type="button" class="btn btn-sm btn-link p-0" id="add-pos-btn-edit-modal">+ Добавить</button></div>
                                     <div id="edit-pos-list"></div>
                                </div>
                                <hr>
                                <div class="mb-3">
                                     <h6 class="small fw-bold">Аватар</h6>
                                     <input type="file" id="edit-avatar-input" class="form-control mb-2">
                                     <input type="hidden" id="edit-current-avatar-url">
                                     <img id="edit-avatar-preview" class="avatar-preview" src="">
                                </div>
                                <div class="mb-3">
                                     <h6 class="small fw-bold">Фото магазина</h6>
                                     <input type="file" id="edit-photo-input" class="form-control" multiple>
                                     <div id="edit-photo-preview-container" class="photo-preview-grid"></div>
                                </div>
                                <div>
                                     <h6 class="small fw-bold">Матрица</h6>
                                     <div id="edit-product-checklist" class="product-checklist"></div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Закрыть</button>
                    <button type="submit" form="edit-dealer-form" class="btn btn-primary">Сохранить</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="quick-visit-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Быстрый визит</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="quick-visit-form">
                        <input type="hidden" id="qv_dealer_id">
                        <div class="mb-3">
                            <label class="form-label">Комментарий</label>
                            <textarea id="qv_comment" class="form-control" rows="3" placeholder="Что сделали?"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Сохранить</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="status-manager-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Управление статусами</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="card bg-light border-0 mb-3">
                        <div class="card-body">
                            <form id="status-form" class="row g-2 align-items-end">
                                <input type="hidden" id="st_id">
                                
                                <div class="col-md-3">
                                    <label class="form-label small fw-bold text-muted">Код (ID)</label>
                                    <input type="text" id="st_value" class="form-control" placeholder="vip" required>
                                    <div class="form-text" style="font-size: 0.7rem; margin-top: 2px;">На латинице</div>
                                </div>

                                <div class="col-md-4">
                                    <label class="form-label small fw-bold text-muted">Название</label>
                                    <input type="text" id="st_label" class="form-control" placeholder="VIP Клиент" required>
                                </div>

                                <div class="col-md-2 col-3">
                                    <label class="form-label small fw-bold text-muted">Цвет</label>
                                    <input type="color" id="st_color" class="form-control form-control-color w-100" value="#B9040A" title="Выберите цвет">
                                </div>

                                <div class="col-md-3 col-9">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="st_visible" checked>
                                        <label class="form-check-label small" for="st_visible">В списке</label>
                                    </div>
                                </div>

                                <div class="col-12 mt-2 text-end">
                                    <button type="button" id="btn-cancel-edit-status" class="btn btn-sm btn-link text-muted me-2" style="display:none;">Отмена</button>
                                    <button type="submit" class="btn btn-primary px-4" id="btn-save-status">Сохранить</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light small text-muted text-uppercase">
                                <tr><th>Цвет</th><th>Название</th><th>Код (ID)</th><th class="text-center">В списке</th><th class="text-end">Действия</th></tr>
                            </thead>
                            <tbody id="status-manager-list"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="dashboard-settings-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content">
                <div class="modal-header border-0 pb-0">
                    <h6 class="modal-title fw-bold">Настройка дашборда</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted small mb-3">Выберите метрики для отображения:</p>
                    <div class="d-flex flex-column gap-2" id="dash-settings-list">
                        </div>
                </div>
                <div class="modal-footer border-0 pt-0">
                    <button type="button" class="btn btn-primary w-100" onclick="saveDashboardConfig()">Сохранить</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-container-custom" class="toast-container-custom"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js?v={{VER}}"></script> 
</body>
</html>
